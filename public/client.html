<html>
<head>
<link rel="stylesheet" type="text/css" href="client.css">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
</head>

<center>
    <div id="main-page" class="outerbox">
        <div id="main-message" class="messagebox"></div>
        <center>
            <form>
                Username: <input id="main-username" type="text" name="username"><br>
                Password: <input id="main-password" type="password" name="password"><br>
                <br>
                <input id="login-button" type="submit" value="Login">
                <input id="add-button" type="submit" value="Add User">
            </form>
        </center>
    </div>
</center>
<center>
    <div id="welcome-page" class="outerbox">
        <div id="welcome-message" class="messagebox"></div>
        <center>
            <form>
                <input type="submit" id="logout-button" value="Logout">
            </form>
        </center>
    </div>
</center>

<script type="text/javascript">
/* Mainly looked at the given client.html and client.js file as a template for the logic.
   Could not think of a better way to certain functionality such as the ajax request. */

ERR_BAD_CREDENTIALS = -1;
ERR_USER_EXISTS = -2;
ERR_BAD_USERNAME = -3;
ERR_BAD_PASSWORD = -4;

/* The page tells the main page to appear when the page is ready. */
$(document).ready(function() {
   show_main_page();
 });

/* Copied the functions from the client.html.
   Shows the main page with the default message if the param is empty. */
function show_main_page(message) {
  if(!message) {
    message = "Please enter your credentials below";
  }
  $('#welcome-page').hide();
  $('#main-username').val("");
  $('#main-password').val("");
  $('#main-message').html(message);
  $('#main-page').show();
}

/* Shows the welcome page when successfully logged in. */
function show_welcome_page(user, count) {
   $('#main-page').hide();
   $('#welcome-page').show();
   $('#welcome-message').html("Welcome " + user + ".<br>You have logged in " + count + " times.");
}

$('#login-button').click(function() {
   username = $('#main-username').val()
   password = $('#main-password').val()
   json_request("/users/login", {user: username, password: password }, 
                                function(data) {
                                    if (data.errCode == 1) {
                                        show_welcome_page(username, data.count);
                                    } else {
                                        show_main_page(get_message_for_errcode(data.errCode));
                                    }
                                },
                                function(error) {
                                    alert('ERROR!!!');
                                });

   return false;
});

/* Shows the welcome page if the user is successfully added. */
$('#add-button').click(function() {
   username = $('#main-username').val()
   password = $('#main-password').val()
   json_request("/users/add", {user: username, password: password },
                                function(data) {
                                    if (data.errCode == 1) {
                                        show_welcome_page(username, data.count);
                                    } else {
                                        show_main_page(get_message_for_errcode(data.errCode));
                                    }
                                },
                                function(error) {
                                    alert('ERROR!!!');
                                });
   return false;
});

/* 
$('#logout-button').click(function() {
  show_main_page();
  return false;
});

/* Sends json request via post to a URL*/
function json_request(page, dict, success, failure) {
    $.ajax({
        type: 'POST',
        url: page,
        data: JSON.stringify(dict),
        contentType: "application/json",
        dataType: "json",
        success: success,
        failure: failure
    });
}

/* "Invalid username and password combination. Please try again. " (ERR_BAD_CREDENTIALS)
       "The user name should be non-empty and at most 128 characters long. Please try again." (ERR_BAD_USERNAME)
       "This user name already exists. Please try again." (ERR_USER_EXISTS)
       "The password should be at most 128 characters long. Please try again." (ERR_BAD_PASSWORD) */
function get_message_for_errcode(code) {
    if(code == ERR_BAD_CREDENTIALS) {
        return ("Invalid username and password combination. Please try again. ");
    } else if(code == ERR_USER_EXISTS) {
        return ("This user name already exists. Please try again.");
    } else if(code == ERR_BAD_USERNAME) {
        return ("The user name should be non-empty and at most 128 characters long. Please try again.");
    } else if(code == ERR_BAD_PASSWORD) {
        return ("The password should be at most 128 characters long. Please try again.");
    } else {
        return ("Unknown error occured: " + code);
   }
}

</script>
</html>
